<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á: ‡πÄ‡∏Å‡∏≤‡∏∞‡∏°‡∏´‡∏≤‡∏™‡∏ô‡∏∏‡∏Å</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap');

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 600px;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
        }

        h1 { color: #2c3e50; margin-bottom: 10px; }
        h2 { color: #34495e; font-size: 1.2rem; margin-bottom: 20px; }
        
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.5s; }

        input, select, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Sarabun', sans-serif;
            box-sizing: border-box;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: 0.3s;
        }
        button:hover { background-color: #2980b9; }
        
        .btn-secondary { background-color: #95a5a6; }
        .btn-secondary:hover { background-color: #7f8c8d; }
        
        .btn-danger { background-color: #e74c3c; }
        .btn-danger:hover { background-color: #c0392b; }

        .member-list {
            text-align: left;
            margin-bottom: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        .member-item {
            background: #ecf0f1;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }

        /* Card Selection */
        .system-card {
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: 0.3s;
        }
        .system-card:hover { border-color: #3498db; background: #ebf5fb; }
        .system-card h3 { margin: 0; }
        .system-card p { font-size: 0.9rem; color: #7f8c8d; margin-top: 5px; }

        /* Result Area */
        #result-card {
            background: white;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .bar-container {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 0.85rem;
        }
        .name-label { width: 80px; text-align: right; margin-right: 10px; }
        .bar-bg { flex-grow: 1; background: #ecf0f1; height: 20px; border-radius: 10px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 1s; }
        .wealth-val { width: 50px; text-align: left; margin-left: 10px; font-weight: bold; }

        /* Crisis Alert */
        .crisis-alert {
            background-color: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div id="step-1" class="step active">
        <h1>üèùÔ∏è ‡πÄ‡∏Å‡∏≤‡∏∞‡∏°‡∏´‡∏≤‡∏™‡∏ô‡∏∏‡∏Å</h1>
        <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
        <input type="text" id="group-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
        
        <div style="display: flex; gap: 5px;">
            <input type="text" id="new-member" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å..." onkeypress="handleEnter(event)">
            <button onclick="addMember()" style="width: auto;">+</button>
        </div>

        <div class="member-list" id="member-list-display">
            </div>

        <button onclick="goToStep2()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏≠‡∏ö‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à</button>
    </div>

    <div id="step-2" class="step">
        <h1>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£</h1>
        <h2>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏≤‡∏∞‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?</h2>
        
        <div class="system-card" onclick="startGame('market')">
            <h3>üèôÔ∏è ‡πÄ‡∏Å‡∏≤‡∏∞‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏™‡∏£‡∏µ (Market)</h3>
            <p>‡∏°‡∏∑‡∏≠‡πÉ‡∏Ñ‡∏£‡∏¢‡∏≤‡∏ß‡∏™‡∏≤‡∏ß‡πÑ‡∏î‡πâ‡∏™‡∏≤‡∏ß‡πÄ‡∏≠‡∏≤ ‡∏£‡∏±‡∏ê‡πÑ‡∏°‡πà‡πÅ‡∏ó‡∏£‡∏Å‡πÅ‡∏ã‡∏á</p>
        </div>
        <div class="system-card" onclick="startGame('command')">
            <h3>üö© ‡πÄ‡∏Å‡∏≤‡∏∞‡∏ó‡∏µ‡πà 2: ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Command)</h3>
            <p>‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏°‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô</p>
        </div>
        <div class="system-card" onclick="startGame('mixed')">
            <h3>‚öñÔ∏è ‡πÄ‡∏Å‡∏≤‡∏∞‡∏ó‡∏µ‡πà 3: ‡∏ú‡∏™‡∏°‡∏ú‡∏™‡∏≤‡∏ô (Mixed)</h3>
            <p>‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏©‡∏µ‡∏Ñ‡∏ô‡∏£‡∏ß‡∏¢ ‡∏°‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ô‡∏à‡∏ô</p>
        </div>
        
        <button class="btn-secondary" onclick="backToStep1()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
    </div>

    <div id="step-3" class="step">
        <h1>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå</h1>
        
        <div id="result-card">
            <h2 id="res-group-name" style="color:#2c3e50; border-bottom: 2px solid #3498db; padding-bottom:10px;"></h2>
            <p><strong>‡∏£‡∏∞‡∏ö‡∏≠‡∏ö‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à:</strong> <span id="res-system-name"></span></p>
            
            <div id="crisis-box" class="crisis-alert">
                üî• <strong>‡πÄ‡∏Å‡∏¥‡∏î‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏†‡∏±‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥!</strong><br>
                ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏ô‡πÄ‡∏Å‡∏≤‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô...
            </div>

            <div id="chart-area" style="margin-top: 20px;">
                </div>

            <div style="margin-top: 20px; font-size: 0.9rem; background: #f9f9f9; padding: 10px; border-radius: 8px;">
                <p>üí∞ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏£‡∏ß‡∏°: <strong id="res-total"></strong></p>
                <p>üìâ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏∑‡πà‡∏≠‡∏°‡∏•‡πâ‡∏≥ (Gini): <strong id="res-gini"></strong> (‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏´‡∏•‡∏∑‡πà‡∏≠‡∏°‡∏•‡πâ‡∏≥)</p>
                <p>üòä ‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç: <strong id="res-happiness"></strong></p>
            </div>
        </div>

        <button class="btn-danger" onclick="downloadResult()">üì∏ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ (PNG)</button>
        <button class="btn-secondary" onclick="location.reload()">üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà</button>
    </div>
</div>

<script>
    let members = [];
    let groupName = "";
    
    // --- Step 1 Logic ---
    function handleEnter(e) {
        if(e.key === 'Enter') addMember();
    }

    function addMember() {
        const input = document.getElementById('new-member');
        const name = input.value.trim();
        if (name) {
            members.push(name);
            renderMembers();
            input.value = '';
            input.focus();
        }
    }

    function renderMembers() {
        const list = document.getElementById('member-list-display');
        list.innerHTML = members.map((m, i) => 
            `<div class="member-item"><span>${i+1}. ${m}</span> <span style="color:red; cursor:pointer;" onclick="removeMember(${i})">x</span></div>`
        ).join('');
    }

    function removeMember(index) {
        members.splice(index, 1);
        renderMembers();
    }

    function goToStep2() {
        groupName = document.getElementById('group-name').value;
        if (!groupName || members.length < 2) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏° ‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏ô");
            return;
        }
        document.getElementById('step-1').classList.remove('active');
        document.getElementById('step-2').classList.add('active');
    }

    function backToStep1() {
        document.getElementById('step-2').classList.remove('active');
        document.getElementById('step-1').classList.add('active');
    }

    // --- Step 2 & 3 Logic (The Simulation) ---
    function startGame(system) {
        document.getElementById('step-2').classList.remove('active');
        document.getElementById('step-3').classList.add('active');

        // Logic ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (Simulation)
        let results = [];
        let systemName = "";
        let baseWealth = 100; // ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
        let color = "";

        // ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡πà‡∏≤ Luck ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô (0.1 ‡∏ñ‡∏∂‡∏á 1.9)
        let luckFactors = members.map(() => 0.5 + Math.random() * 1.5);

        if (system === 'market') {
            systemName = "‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏™‡∏£‡∏µ (Free Market)";
            color = "#27ae60"; // Green
            // ‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏™‡∏£‡∏µ: ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ Luck/Skill ‡∏™‡∏π‡∏á ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å (Exponential)
            results = members.map((m, i) => ({
                name: m,
                wealth: Math.floor(baseWealth * (luckFactors[i] ** 3)) // ‡∏£‡∏ß‡∏¢‡∏Å‡∏£‡∏∞‡∏à‡∏∏‡∏Å
            }));
        } else if (system === 'command') {
            systemName = "‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Socialism)";
            color = "#c0392b"; // Red
            // ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô: ‡πÄ‡∏≠‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤
            let totalProduction = members.reduce((sum, _, i) => sum + (baseWealth * luckFactors[i]), 0);
            // ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏•‡∏î‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏î‡πÅ‡∏£‡∏á‡∏à‡∏π‡∏á‡πÉ‡∏à (Simulation Gimmick)
            let sharedWealth = Math.floor((totalProduction * 0.8) / members.length); 
            results = members.map(m => ({ name: m, wealth: sharedWealth }));
        } else {
            systemName = "‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏° (Mixed)";
            color = "#f39c12"; // Orange
            // ‡∏ú‡∏™‡∏°: ‡∏´‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏° Luck ‡πÅ‡∏ï‡πà‡πÇ‡∏î‡∏ô‡∏†‡∏≤‡∏©‡∏µ 30% ‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
            let rawWealth = members.map((_, i) => baseWealth * (luckFactors[i] ** 2));
            let taxPool = 0;
            let afterTax = rawWealth.map(w => {
                let tax = w * 0.3; // ‡∏†‡∏≤‡∏©‡∏µ 30%
                taxPool += tax;
                return w - tax;
            });
            let welfare = taxPool / members.length;
            results = members.map((m, i) => ({
                name: m,
                wealth: Math.floor(afterTax[i] + welfare)
            }));
        }

        // --- Apply Crisis (Climax) ---
        // ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ñ‡∏ô‡∏à‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏•‡∏≤‡∏î
        const crisisDiv = document.getElementById('crisis-box');
        crisisDiv.style.display = 'block';

        results = results.map(r => {
            let damage = 0;
            if (system === 'market') {
                // ‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏™‡∏£‡∏µ: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏ô‡∏à‡∏ô‡πÇ‡∏î‡∏ô‡∏´‡∏ô‡∏±‡∏Å (‡∏´‡∏≤‡∏¢‡πÑ‡∏õ 50%), ‡∏Ñ‡∏ô‡∏£‡∏ß‡∏¢‡∏°‡∏µ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞ (‡∏´‡∏≤‡∏¢ 10%)
                damage = r.wealth < baseWealth ? 0.5 : 0.1;
            } else if (system === 'command') {
                // ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏ô‡∏¥‡∏¢‡∏°: ‡∏£‡∏±‡∏ê‡∏ä‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡πÇ‡∏î‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô 30%
                damage = 0.3;
            } else {
                // ‡∏ú‡∏™‡∏°: ‡∏°‡∏µ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡πâ‡∏≤‡∏á ‡πÇ‡∏î‡∏ô 25%
                damage = 0.25;
            }
            return { ...r, wealth: Math.floor(r.wealth * (1 - damage)) };
        });

        // Sort ‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
        results.sort((a, b) => b.wealth - a.wealth);

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Stats
        let totalWealth = results.reduce((sum, r) => sum + r.wealth, 0);
        let maxWealth = results[0].wealth;
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Gini ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ (High - Low) / Total
        let gini = ((results[0].wealth - results[results.length-1].wealth) / totalWealth * members.length).toFixed(2);
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç (‡∏ñ‡πâ‡∏≤‡∏£‡∏ß‡∏¢‡∏°‡∏≤‡∏Å‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏ô ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏≠‡∏≤‡∏à‡∏ï‡πà‡∏≥‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á, ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡πÅ‡∏ï‡πà‡∏à‡∏ô‡∏Å‡πá‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç)
        let happiness = "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á";
        if (gini > 2.0) happiness = "‡∏ï‡πà‡∏≥ (‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á)";
        else if (totalWealth < (baseWealth * members.length * 0.5)) happiness = "‡∏ï‡πà‡∏≥ (‡∏≠‡∏î‡∏≠‡∏¢‡∏≤‡∏Å)";
        else happiness = "‡∏™‡∏π‡∏á";

        // Render ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        document.getElementById('res-group-name').innerText = groupName;
        document.getElementById('res-system-name').innerText = systemName;
        document.getElementById('res-total').innerText = totalWealth.toLocaleString();
        document.getElementById('res-gini').innerText = gini;
        document.getElementById('res-happiness').innerText = happiness;

        const chartHtml = results.map(r => {
            let percent = (r.wealth / maxWealth) * 100;
            return `
            <div class="bar-container">
                <div class="name-label">${r.name}</div>
                <div class="bar-bg">
                    <div class="bar-fill" style="width: ${percent}%; background-color: ${color};"></div>
                </div>
                <div class="wealth-val">${r.wealth}</div>
            </div>`;
        }).join('');
        
        document.getElementById('chart-area').innerHTML = chartHtml;
    }

    // --- Export Logic ---
    function downloadResult() {
        const resultCard = document.getElementById("result-card");
        html2canvas(resultCard).then(canvas => {
            const link = document.createElement("a");
            document.body.appendChild(link);
            link.download = `result-${groupName}.png`;
            link.href = canvas.toDataURL();
            link.target = '_blank';
            link.click();
        });
    }
</script>

</body>
</html>
